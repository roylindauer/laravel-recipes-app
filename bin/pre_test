#!/usr/bin/env sh

# Create the testing database with root user because the user the mysql container creates
# doesn't have the necessary permissions to create databases
docker compose exec db mysqladmin create -uroot -proot recipes_testing

# Grant all privileges to the database user to the testing database
docker compose exec db mysql -e "GRANT ALL PRIVILEGES ON recipes_testing.* TO 'admin'@'%'; FLUSH PRIVILEGES;" -uroot -proot

# Prepare the database for testing
php artisan migrate --env=testing
